from math import *
import math
import csv



def calcRTT(distance):
    dtrans = 1.0/5000.0
    propSpeed = 179900000.0
    conversionfactor = 1609.34
    dprop = distance*conversionfactor/propSpeed
    return (dprop+dtrans)

def csvHandlerRTT():

    percentView = [0.05177359001,0.05160985243,0.05162804549,0.05191913453,0.0519373276,0.0522466097,0.05226480276,0.05173720388,-0.9391116845,0.05208287211,0.05213745131,0.05210106518,0.05135514952,0.05195552066,0.05217383744,0.05221022357,0.05221022357,0.05191913453,0.05211925824,0.05210106518,0.05173720388,0.0521920305,0.05159165936,0.05173720388,0.05173720388,-0.9390934915,0.05190094147,0.05180997614,0.05208287211,-0.9401123031,0.05199190679,0.05191913453,0.05208287211,-0.9391298776,0.05177359001,0.05217383744,0.0518827484,0.05210106518,0.05213745131,0.05204648598,0.05173720388,0.05173720388,0.05211925824,0.05182816921,0.05177359001,
                   0.05210106518,0.05173720388,0.05217383744,0.05210106518,0.05184636227,0.05230118889,0.05177359001,-0.9401668823,0.05213745131,0.05190094147,0.05217383744,0.009110853047,0.05168262469,0.05230118889,0.0519373276,0.05190094147,0.0515188871,0.05195552066,0.0522466097,0.05164623856,0.006418279456,0.05173720388,0.05799561817,0.05173720388,0.05828670721,0.05217383744,0.05222841663,0.0519373276,0.05206467905,0.0512641842,0.05173720388,0.05812296963,0.05191913453,0.05221022357,0.05140972872,0.05213745131,0.05171901082,0.05211925824,0.05210106518,0.05182816921,0.05171901082,0.05139153565,0.05173720388,0.0522466097,-0.9391480707,
                   0.05191913453,0.05241034728,0.05206467905,0.05190094147,0.05190094147,0.05213745131,0.05190094147,0.0521920305,0.05190094147,0.05222841663,0.05182816921,0.05821393495,0.05168262469,0.05215564437,0.05199190679,0.0522466097,-0.9391844568,0.05168262469,0.05197371372,0.05792284592,0.05213745131,0.0519373276,0.05159165936,0.05144611485,0.05173720388,0.05213745131,0.05150069404,0.05210106518,0.05171901082,0.05191913453,0.05226480276,0.05175539695,0.05159165936,0.0519373276,0.0522466097,0.05180997614,0.05159165936,0.05191913453,0.05206467905,0.05211925824,0.05173720388,0.05173720388,0.0522466097,0.05208287211,0.0522466097,
                   0.05162804549,0.0515188871,0.05211925824,0.0521920305,0.05215564437,-0.9390934915,0.05173720388,0.05222841663,0.05215564437,0.05173720388,0.05177359001,0.05173720388,0.05184636227,0.05244673341,0.05144611485,0.05168262469,0.0519373276,0.05186455534,0.05173720388,0.05213745131,0.05173720388,0.05215564437,0.0515188871,0.05173720388,0.05175539695,0.05186455534,0.05173720388,0.05213745131,0.0518827484,0.05191913453,0.0521920305,0.05191913453,0.05210106518,0.05206467905,0.05213745131,0.05186455534,0.05159165936,0.05191913453,0.05206467905,0.05146430791,0.05199190679,0.05211925824,0.05210106518,0.05199190679,0.05186455534,
                   -0.9391298776,0.05242854034,0.05164623856,0.05806839043,0.0522466097,0.05208287211,0.05159165936,0.05168262469,0.0521920305,0.0521920305,0.05230118889,0.05173720388,0.0515734663,0.05210106518,0.05173720388,0.05162804549,0.05191913453,0.05155527323,0.05222841663,0.05222841663,0.05215564437,0.0521920305,0.05173720388,0.05195552066,0.05173720388,0.05180997614,0.0519373276,-0.9402032684,0.05204648598,0.05191913453,-0.9401486892,0.05168262469,0.05175539695,0.05191913453,0.05173720388,-0.9390934915,0.05173720388,0.0519373276,0.0521920305,0.05213745131,-0.9391480707,0.05213745131,0.05160985243,0.05175539695,0.05211925824,
                   0.05191913453,0.05210106518,0.05197371372,0.05173720388,0.05230118889,0.05173720388,0.0525013126,0.05952383562,0.05208287211,0.05221022357,0.0519373276,0.05191913453,0.05210106518,0.05195552066,0.0525558918,0.05177359001,0.05210106518,0.05191913453,0.05211925824,0.05159165936,0.0518827484,0.0518827484,0.05173720388,0.05173720388]


    fileOut1 = open('rttOut.csv','w+')
    fileOut2 = open('minIndexes.csv','w+')

    #Prepare the input file for reading
    file = open("distances.csv")
    dRdr = csv.DictReader(file)

    #Setup Headers for rttOut.csv
    fileOut1.write("Country,")
    for j in range(1,100):
        fileOut1.write(str(j)+',')
    fileOut1.write('\n')
    #Setup Headers for minIndexes.csv
    fileOut2.write("Country,Latitude,Longitude,index\n")

    #Process Input
    k = 0;
    for country in dRdr:
        fileOut1.write(country['CountryCode']+',')
        minRTT = 100;
        for i in range(1,len(country)-3):
            distance = float(country[str(i)])
            packetRTT = calcRTT(distance) #Calculate RTT
            #Update minRTT if needed
            if(packetRTT<minRTT):
                minRTT = packetRTT
            fileOut1.write(str(packetRTT))
            fileOut1.write(",")
        fileOut1.write("\n")
        fileOut2.write(country['CountryCode']+','+country['Latitude']+','+country['Longitude']+',')
        #fileOut2.write(country['CountryCode']+',')
        fileOut2.write(str((minRTT*10)+percentView[k]))
        fileOut2.write("\n")
        k+=1
    file.close()
    fileOut1.close()
    fileOut2.close()
